{{- $ca := genCA "lxcfs-on-kubernetes-ca" 3650 }}
{{- $cn := "lxcfs-on-kubernetes-webhook-service" }}
{{- $dns1 := printf "%s.%s" $cn .Release.Namespace }}
{{- $dns2 := printf "%s.%s.svc" $cn .Release.Namespace }}
{{- $cert := genSignedCert $cn nil (list $dns1 $dns2) 3650 $ca }}

{{- /* Code generated by make. DO NOT EDIT. */ -}}
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  annotations:
    cert-manager.io/inject-ca-from: '{{.Release.Namespace}}/{{. | include "chart.fullname"}}-serving-cert'
  name: '{{ include "chart.fullname" . }}-mutating-webhook-configuration'
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: {{ $ca.Cert | b64enc | quote }}
    service:
      name: '{{ include "chart.fullname" . }}-webhook-service'
      namespace: {{ .Release.Namespace | quote }}
      path: /mount-lxcfs
  failurePolicy: Ignore
  name: club.cndoit18.lxcfs-on-kubernetes
  namespaceSelector:
    matchLabels: {{- toYaml .Values.lxcfs.matchLabels | nindent 6 }}
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - pods
  sideEffects: NoneOnDryRun

---
apiVersion: v1
kind: Secret
metadata:
  name: '{{ include "chart.fullname" . }}-certificate'
  namespace: {{ .Release.Namespace | quote }}
type: kubernetes.io/tls
data:
  tls.crt: {{ $cert.Cert | b64enc | quote }}
  tls.key: {{ $cert.Key | b64enc | quote }}
  ca.crt: {{ $ca.Cert | b64enc | quote }}
